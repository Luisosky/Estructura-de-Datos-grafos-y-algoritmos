<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grafos y algoritmos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.21.1/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/graphlib/2.1.8/graphlib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/javascript-astar/0.4.1/astar.min.js"></script>
    <style>
        #cy {
            width: 80%;
            height: 600px;
            display: inline-block;
        }
        #controls {
            width: 18%;
            display: inline-block;
            vertical-align: top;
        }
        button {
            display: block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="controls">
        <button id="add-node">Agregar Nodo</button>
        <button id="add-edge">Agregar Arista</button>
        <button id="run-dijkstra">Dijkstra</button>
        <button id="run-kruskal">Kruskal</button>
        <button id="run-bellman-ford">Bellman-Ford</button>
        <button id="run-yen">Yen</button>
    </div>
    <div id="cy"></div>

    <script>
        let cy = cytoscape({
            container: document.getElementById('cy'),
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': 'lightblue',
                        'label': 'data(id)'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 3,
                        'line-color': 'gray',
                        'target-arrow-color': 'gray',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'label': 'data(weight)'
                    }
                }
            ],
            elements: []
        });

        let graph = new graphlib.Graph({ directed: false });
        let nodeCount = 0;

        document.getElementById('add-node').addEventListener('click', () => {
            nodeCount++;
            let nodeId = `n${nodeCount}`;
            cy.add({
                group: 'nodes',
                data: { id: nodeId },
                position: { x: Math.random() * 600, y: Math.random() * 600 }
            });
            graph.setNode(nodeId);
        });

        document.getElementById('add-edge').addEventListener('click', () => {
            let source = prompt("Ingrese el ID del nodo fuente:");
            let target = prompt("Ingrese el ID del nodo destino:");
            let weight = parseFloat(prompt("Ingrese el peso de la arista:"));
            let color = prompt("Ingrese el color de la arista (por ejemplo, 'red', 'blue'):");

            if (source && target && !isNaN(weight) && color && graph.hasNode(source) && graph.hasNode(target)) {
                cy.add({
                    group: 'edges',
                    data: { id: `e${source}-${target}`, source: source, target: target, weight: weight },
                    style: { 'line-color': color, 'target-arrow-color': color }
                });
                graph.setEdge(source, target, weight);
            } else {
                alert("Verifica que los nodos existen y que los datos son válidos.");
            }
        });

        document.getElementById('run-dijkstra').addEventListener('click', () => {
            let source = prompt("Ingrese el ID del nodo fuente:");
            let target = prompt("Ingrese el ID del nodo destino:");
            if (source && target && graph.hasNode(source) && graph.hasNode(target)) {
                let path = graphlib.alg.dijkstra(graph, source, e => graph.edge(e));
                let result = [];
                let current = target;
                while (current !== source) {
                    result.push(current);
                    current = path[current].predecessor;
                }
                result.push(source);
                result.reverse();
                alert(`Camino más corto: ${result.join(' -> ')}`);
            } else {
                alert("Verifica que los nodos existen.");
            }
        });

        document.getElementById('run-kruskal').addEventListener('click', () => {
            let mst = graphlib.alg.kruskal(graph);
            if (mst.length === 0) {
                alert("No se pudo generar un árbol de expansión mínima. Verifica que el grafo es conexo.");
            } else {
                let mstEdges = mst.map(edge => `${edge.v} - ${edge.w} (Peso: ${edge.weight})`);
                alert(`Árbol de expansión mínima:\n${mstEdges.join('\n')}`);
            }
        });


        document.getElementById('run-bellman-ford').addEventListener('click', () => {
            let source = prompt("Ingrese el ID del nodo fuente:");
            let target = prompt("Ingrese el ID del nodo destino:");
            if (source && target && graph.hasNode(source) && graph.hasNode(target)) {
                let path = graphlib.alg.bellmanFord(graph, source, e => graph.edge(e));
                if (path[target].distance === Infinity) {
                    alert("No se pudo encontrar un camino desde el nodo fuente al destino.");
                    return;
                }
                let result = [];
                let current = target;
                while (current !== source) {
                    if (!path[current].predecessor) {
                        alert("No hay camino disponible entre los nodos especificados.");
                        return;
                    }
                    result.push(current);
                    current = path[current].predecessor;
                }
                result.push(source);
                result.reverse();
                alert(`Camino más corto: ${result.join(' -> ')}`);
            } else {
                alert("Verifica que los nodos existen.");
            }
        });


        document.getElementById('run-yen').addEventListener('click', () => {
            alert('El algoritmo de Yen aún no está implementado.');
        });
    </script>
</body>
</html>
